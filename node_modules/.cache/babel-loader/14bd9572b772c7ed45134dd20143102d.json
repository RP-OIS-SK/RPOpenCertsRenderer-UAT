{"ast":null,"code":"import _regeneratorRuntime from\"/OpenCerts/opencerts-renderer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/OpenCerts/opencerts-renderer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/OpenCerts/opencerts-renderer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/OpenCerts/opencerts-renderer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/OpenCerts/opencerts-renderer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/OpenCerts/opencerts-renderer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/OpenCerts/opencerts-renderer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import styles from\"../certificateViewer.scss\";import connectToParent from\"penpal/lib/connectToParent\";import DocumentViewer from\"./documentViewer\";import{documentTemplateTabs,inIframe}from\"./utils\";var DocumentViewerContainer=/*#__PURE__*/function(_Component){_inherits(DocumentViewerContainer,_Component);var _super=_createSuper(DocumentViewerContainer);function DocumentViewerContainer(props){var _this;_classCallCheck(this,DocumentViewerContainer);_this=_super.call(this,props);_this.handleDocumentChange=_this.handleDocumentChange.bind(_assertThisInitialized(_this));_this.selectTemplateTab=_this.selectTemplateTab.bind(_assertThisInitialized(_this));_this.updateParentHeight=_this.updateParentHeight.bind(_assertThisInitialized(_this));_this.updateParentTemplateTabs=_this.updateParentTemplateTabs.bind(_assertThisInitialized(_this));_this.handleObfuscation=_this.handleObfuscation.bind(_assertThisInitialized(_this));_this.state={parentFrameConnection:null,document:null,tabIndex:0,templates:null};return _this;}_createClass(DocumentViewerContainer,[{key:\"updateHeightWhenResize\",value:function updateHeightWhenResize(){window.addEventListener(\"resize\",this.updateParentHeight);}// Use postMessage to update iframe's parent to scale the height\n},{key:\"updateParentHeight\",value:function(){var _updateParentHeight=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var parentFrameConnection,parent;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!inIframe()){_context.next=8;break;}parentFrameConnection=this.state.parentFrameConnection;_context.next=4;return parentFrameConnection;case 4:parent=_context.sent;if(!parent.updateHeight){_context.next=8;break;}_context.next=8;return parent.updateHeight(document.documentElement.offsetHeight);case 8:case\"end\":return _context.stop();}}},_callee,this);}));function updateParentHeight(){return _updateParentHeight.apply(this,arguments);}return updateParentHeight;}()// Use postMessage to update iframe's parent onw the selection of templates available for this document\n},{key:\"updateParentTemplateTabs\",value:function(){var _updateParentTemplateTabs=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var templates,parentFrameConnection,parent;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return documentTemplateTabs(this.state.document);case 2:templates=_context2.sent;this.setState({templates:templates});if(!inIframe()){_context2.next=12;break;}parentFrameConnection=this.state.parentFrameConnection;_context2.next=8;return parentFrameConnection;case 8:parent=_context2.sent;if(!parent.updateTemplates){_context2.next=12;break;}_context2.next=12;return parent.updateTemplates(documentTemplateTabs(this.state.document));case 12:case\"end\":return _context2.stop();}}},_callee2,this);}));function updateParentTemplateTabs(){return _updateParentTemplateTabs.apply(this,arguments);}return updateParentTemplateTabs;}()},{key:\"handleObfuscation\",value:function(){var _handleObfuscation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(field){var parentFrameConnection,parent;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!inIframe()){_context3.next=6;break;}parentFrameConnection=this.state.parentFrameConnection;_context3.next=4;return parentFrameConnection;case 4:parent=_context3.sent;if(parent.handleObfuscation){parent.handleObfuscation(field);}case 6:case\"end\":return _context3.stop();}}},_callee3,this);}));function handleObfuscation(_x){return _handleObfuscation.apply(this,arguments);}return handleObfuscation;}()},{key:\"selectTemplateTab\",value:function(){var _selectTemplateTab=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(tabIndex){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:this.setState({tabIndex:tabIndex});case 1:case\"end\":return _context4.stop();}}},_callee4,this);}));function selectTemplateTab(_x2){return _selectTemplateTab.apply(this,arguments);}return selectTemplateTab;}()},{key:\"handleDocumentChange\",value:function handleDocumentChange(document){this.setState({document:document});this.updateParentTemplateTabs();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){this.updateParentHeight();}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var renderDocument=this.handleDocumentChange;var selectTemplateTab=this.selectTemplateTab;var getTemplates=function getTemplates(){return _this2.state.templates;};window.openAttestation={renderDocument:renderDocument,selectTemplateTab:selectTemplateTab,getTemplates:getTemplates};if(inIframe()){var parentFrameConnection=connectToParent({methods:{renderDocument:renderDocument,selectTemplateTab:selectTemplateTab}}).promise;this.setState({parentFrameConnection:parentFrameConnection});}this.updateHeightWhenResize();}},{key:\"render\",value:function render(){if(!this.state.document){return null;}return/*#__PURE__*/React.createElement(\"div\",{className:\"frameless-tabs\",id:\"rendered-certificate\"},/*#__PURE__*/React.createElement(DocumentViewer,{id:styles[\"frameless-container\"],document:this.state.document,tabIndex:this.state.tabIndex,handleHeightUpdate:this.updateParentHeight,handleObfuscation:this.handleObfuscation}));}}]);return DocumentViewerContainer;}(Component);export default DocumentViewerContainer;","map":{"version":3,"sources":["/OpenCerts/opencerts-renderer/src/components/documentViewer/documentViewerContainer.js"],"names":["React","Component","styles","connectToParent","DocumentViewer","documentTemplateTabs","inIframe","DocumentViewerContainer","props","handleDocumentChange","bind","selectTemplateTab","updateParentHeight","updateParentTemplateTabs","handleObfuscation","state","parentFrameConnection","document","tabIndex","templates","window","addEventListener","parent","updateHeight","documentElement","offsetHeight","setState","updateTemplates","field","renderDocument","getTemplates","openAttestation","methods","promise","updateHeightWhenResize"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport styles from \"../certificateViewer.scss\";\nimport connectToParent from \"penpal/lib/connectToParent\";\nimport DocumentViewer from \"./documentViewer\";\nimport { documentTemplateTabs, inIframe } from \"./utils\";\n\nclass DocumentViewerContainer extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleDocumentChange = this.handleDocumentChange.bind(this);\n    this.selectTemplateTab = this.selectTemplateTab.bind(this);\n    this.updateParentHeight = this.updateParentHeight.bind(this);\n    this.updateParentTemplateTabs = this.updateParentTemplateTabs.bind(this);\n    this.handleObfuscation = this.handleObfuscation.bind(this);\n    this.state = {\n      parentFrameConnection: null,\n      document: null,\n      tabIndex: 0,\n      templates: null\n    };\n  }\n\n  updateHeightWhenResize() {\n    window.addEventListener(\"resize\", this.updateParentHeight);\n  }\n\n  // Use postMessage to update iframe's parent to scale the height\n  async updateParentHeight() {\n    if (inIframe()) {\n      const { parentFrameConnection } = this.state;\n      const parent = await parentFrameConnection;\n      if (parent.updateHeight)\n        await parent.updateHeight(document.documentElement.offsetHeight);\n    }\n  }\n\n  // Use postMessage to update iframe's parent onw the selection of templates available for this document\n  async updateParentTemplateTabs() {\n    const templates = await documentTemplateTabs(this.state.document);\n    this.setState({ templates });\n    if (inIframe()) {\n      const { parentFrameConnection } = this.state;\n      const parent = await parentFrameConnection;\n      if (parent.updateTemplates) {\n        await parent.updateTemplates(documentTemplateTabs(this.state.document));\n      }\n    }\n  }\n\n  async handleObfuscation(field) {\n    if (inIframe()) {\n      const { parentFrameConnection } = this.state;\n      const parent = await parentFrameConnection;\n      if (parent.handleObfuscation) {\n        parent.handleObfuscation(field);\n      }\n    }\n  }\n\n  async selectTemplateTab(tabIndex) {\n    this.setState({ tabIndex });\n  }\n\n  handleDocumentChange(document) {\n    this.setState({ document });\n    this.updateParentTemplateTabs();\n  }\n\n  componentDidUpdate() {\n    this.updateParentHeight();\n  }\n\n  componentDidMount() {\n    const renderDocument = this.handleDocumentChange;\n    const selectTemplateTab = this.selectTemplateTab;\n    const getTemplates = () => this.state.templates;\n\n    window.openAttestation = {\n      renderDocument,\n      selectTemplateTab,\n      getTemplates\n    };\n\n    if (inIframe()) {\n      const parentFrameConnection = connectToParent({\n        methods: {\n          renderDocument,\n          selectTemplateTab\n        }\n      }).promise;\n      this.setState({ parentFrameConnection });\n    }\n    this.updateHeightWhenResize();\n  }\n\n  render() {\n    if (!this.state.document) {\n      return null;\n    }\n    return (\n      <div className=\"frameless-tabs\" id=\"rendered-certificate\">\n        <DocumentViewer\n          id={styles[\"frameless-container\"]}\n          document={this.state.document}\n          tabIndex={this.state.tabIndex}\n          handleHeightUpdate={this.updateParentHeight}\n          handleObfuscation={this.handleObfuscation}\n        />\n      </div>\n    );\n  }\n}\nexport default DocumentViewerContainer;\n"]},"metadata":{},"sourceType":"module"}